<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>seaside</title>
    <link rel="icon" href="./favicon.ico">
    <link rel="manifest" href="./manifest.json">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <style type="text/css">
      body {
        margin: 0px;
        padding: 0px;
      }
      .container {
        margin: 0px;
        padding: 0px;
        max-width: initial;
      }
      .video-container {
        width: 100%;
        height: 100%;
        position: relative;
        overflow: hidden;
        background-color: dimgray;
      }
      .video-frame {
        width: 100%;
        height: 100%;
        position: absolute;
        overflow: hidden;
      }
      video {
        height: 100%;
        width: 100%;
      }
      video.cover {
        object-fit: cover;
      }
      .text-container {
        top: 0px;
        left: 0px;
        position: relative;
        overflow: auto;
        background-color: rgba(100,100,100,0.5);
        z-index: 100;
      }
      .text-frame {
        color: white;
        background-color: rgba(50,50,50,0.5);
      }
      .text-frame.other {
        color: white;
        background-color: rgba(0,128,0,0.5);
      }
      .text-frame.unresolved {
        color: white;
        background-color: rgba(128,0,0,0.5);
      }
      .text-frame.translate {
        color: white;
        background-color: rgba(0,0,128,0.5);
      }
      span.nav-link, button.dropdown-item {
        cursor: pointer;
      }
      [v-cloak] {
        display: none;
      }
    </style>
  </head>
  <body>
    <div id="vue-app" class="container">
      <div class="video-container">
        <div class="text-container" :class="{invisible : !feature.transcription }" v-cloak>
          <p class="text-frame" v-for="message in messages" :class="{other: message.hasOwnProperty('from'), unresolved: message.hasOwnProperty('unresolved') && message.unresolved, translate: message.hasOwnProperty('translate') && message.translate }">{{ message.text }}</p>
        </div>
        <div class="video-frame" v-for="user in rendererUsers" :style="user.style">
          <video v-videostream="user.stream" :class="styleCover" @click="on_click_video(user.stream)" muted autoplay playsinline></video>
          <audio v-audiostream="user.stream"></audio>
        </div>
      </div>
      <nav class="navbar fixed-bottom navbar-expand-md navbar-dark bg-dark">
        <!-- <span class="navbar-brand">seaside</span> -->
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarCollapse">
          <ul class="navbar-nav mr-auto">
            <li class="nav-item dropup">
              <span class="nav-link dropdown-toggle" id="dropdown_camera" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" :class="{disabled : is_recvonly}">Camera</span>
              <div class="dropdown-menu" aria-labelledby="dropdown10">
                <button type="button" class="dropdown-item" v-for="item in consts.video.size" :class="{active : video.size && item.value == video.size.value}" @click="on_select_size(item)">{{ item.label }}</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" v-for="item in consts.video.fps" :class="{active : video.fps && item.value == video.fps.value}" @click="on_select_fps(item)">{{ item.label }}</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" :class="{active : camera.mute}" @click="on_select_camera_mute()">Mute</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" v-for="cam in camera.device" :class="{active : camera.using && camera.using.deviceId == cam.deviceId}" @click="on_select_camera(cam)">{{ cam.label }}</button>
              </div>
            </li>
            <li class="nav-item dropup">
              <span class="nav-link dropdown-toggle" id="dropdown_microphone" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" :class="{disabled : !has_microphone || is_recvonly}">Microphone</span>
              <div class="dropdown-menu" aria-labelledby="dropdown_microphone">
                <button type="button" class="dropdown-item" :class="{active : microphone.mute}" @click="on_select_microphone_mute()">Mute</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" v-for="mic in microphone.device" :class="{active : microphone.using && microphone.using.deviceId == mic.deviceId}" @click="on_select_microphone(mic)">{{ mic.label }}</button>
              </div>
            </li>
            <li class="nav-item dropup">
              <span class="nav-link dropdown-toggle" id="dropdown_speaker" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" :class="{disabled : !has_speaker || is_sendonly}">Speaker</span>
              <div class="dropdown-menu" aria-labelledby="dropdown_speaker">
                <button type="button" class="dropdown-item" @click="on_speaker_volume()">Volume</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" :class="{active : speaker.mute}" @click="on_select_speaker_mute()">Mute</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" v-for="dev in speaker.device" :class="{active : speaker.using && speaker.using.deviceId == dev.deviceId}" @click="on_select_speaker(dev)">{{ dev.label }}</button>
              </div>
            </li>
            <li class="nav-item dropup">
              <span class="nav-link dropdown-toggle" id="dropdown_layout" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Layout</span>
              <div class="dropdown-menu" aria-labelledby="dropdown_layout">
                <button type="button" class="dropdown-item" @click="on_toggle_fullscreen()">Toggle Fullscreen</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" v-for="item in consts.layout" :class="{active : item.value == layout.value}" @click="on_select_layout(item)">{{ item.label }}</button>
                <div class="dropdown-divider"></div>
                <button type="button" class="dropdown-item" v-for="item in consts.renderer" :class="{active : item.value == renderer.value}" @click="on_select_renderer(item)">{{ item.label }}</button>
              </div>
            </li>
            <li class="nav-item dropup">
              <span class="nav-link dropdown-toggle" id="dropdown_share" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" :class="{disabled : is_recvonly}">Share</span>
              <div class="dropdown-menu" aria-labelledby="dropdown_layout">
                <button type="button" class="dropdown-item" @click="on_select_screen_share()">{{ local_screen ? "Stop Screen Share" : "Start Screen Share"}}</button>
              </div>
            </li>
            <li class="nav-item dropup">
              <span class="nav-link dropdown-toggle" id="dropdown_share" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" :class="{disabled : is_recvonly}">Experimental</span>
              <div class="dropdown-menu" aria-labelledby="dropdown_layout">
                <button type="button" class="dropdown-item" @click="on_select_recognition()">Speech Recognition</button>
              </div>
            </li>
          </ul>
          <span class="navbar-brand" :class="{invisible : !is_p2p }" v-cloak>{{ skyway.peer ? skyway.peer.id  : "" }}</span>
          <form class="form-inline mt-2 mt-md-0" @submit.prevent="on_call">
            <input class="form-control mr-sm-2" type="text" :placeholder="is_p2p ? 'Input PeerID' : 'Input Room Name'" aria-label="call" v-model="skyway.callto" :readonly="is_online">
            <button class="btn btn-outline-success my-2 my-sm-0" v-cloak>{{ (skyway.call || skyway.room) ? "leave" : is_p2p ? "Call" : "Join" }}</button>
          </form>
        </div>
      </nav>
      <div id="modal-recognition" class="modal fade">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Speech Recognition</h4>
              <!-- <h4 class="modal-title">Speech Recognition and Translation</h4> -->
            </div>
            <div class="modal-body">
              <label for="transcription">
                <input type="checkbox" id="transcription" v-model="feature.transcription" :disabled="!support_speech_recognition" />Use Speech Recognition
              </label>
              <br>
              Select Your Language
              <select name="language" v-model="feature.lang" :disabled="!support_speech_recognition">
                <option value="ja-JP">Japanese</option>
                <option value="en-US">English</option>
              </select>
              <!-- <hr>
              <label for="translation">
                <input type="checkbox" id="translation" v-model="feature.translation" :disabled="translation.api == ''" />Translate Incomming Text
              </label>
              <br>
              <label for="speech">
                <input type="checkbox" id="speech" v-model="feature.speech" :disabled="translation.api == ''" />Use Speech Synthesizer
              </label>
              <br>
              <label for="mute_remote_voice">
                <input type="checkbox" id="mute_remote_voice" v-model="feature.mute_remote_voice" />Mute Remote Voice
              </label>
              <hr>
              <h5>Debug</h5>
              <p>
                <label for="self_translation">
                  <input type="checkbox" id="self_translation" v-model="debug.self_translation" :disabled="translation.api == ''" />Translate Your Voice
                </label>
              </p> -->
            </div>
            <div class="modal-footer">
              <!-- <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> -->
              <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      <div id="modal-settings" class="modal">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Welcome</h4>
            </div>
            <div class="modal-body">
              <div class="form-row">
                <div class="col">
                  <div class="form-group">
                    <label for="skyway-mode">Communication Model</label>
                    <select class="form-control" id="skyway-mode" name="mode" v-model="skyway.mode.value">
                      <option value="p2p">P2P</option>
                      <option value="mesh">Mesh</option>
                      <option value="sfu">SFU</option>
                    </select>
                  </div>
                </div>
                <div class="col">
                  <div class="form-group">
                    <label for="communication">Role</label>
                    <select class="form-control" id="communication" v-model="skyway.transmit" :disabled="skyway.mode.value == 'sfu'">
                      <option value="sr">Send and Recv</option>
                      <option value="s">Send Only</option>
                      <option value="r">Recv Only</option>
                    </select>
                  </div>
                </div>
              </div>
              <hr>
              <!-- <h5>Option</h5> -->
              <div class="form-row">
                <div class="col">
                  <div class="form-group">
                    <label for="video-codec">Video Codec</label>
                    <select class="form-control" id="video-codec" v-model="video.codec" :disabled="skyway.mode.value == 'sfu'">
                      <option v-for="codec in consts.video.codec" v-bind:value="codec">{{ codec.label }}</option>
                      </select>
                  </div>
                </div>
                <div class="col">
                  <div class="form-group">
                    <label for="video-bandwidth">Video Bandwidth</label>
                    <select class="form-control" id="video-bandwidth" v-model="video.bandwidth" :disabled="skyway.mode.value == 'sfu'">
                      <option v-for="bandwidth in consts.video.bandwidth" v-bind:value="bandwidth">{{ bandwidth.label }}</option>
                    </select>
                  </div>
                </div>
              </div>
              <div class="form-row">
                <div class="col">
                  <div class="form-group">
                    <label for="audio-codec">Audio Codec</label>
                    <select class="form-control" id="audio-codec" v-model="audio.codec" :disabled="skyway.mode.value == 'sfu'">
                      <option v-for="codec in selectable_audio_codecs(consts.audio.codec)" v-bind:value="codec">{{ codec.label }}</option>
                      </select>
                  </div>
                </div>
                <div class="col">
                  <div class="form-group">
                    <label for="audio-bandwidth">Audio Bandwidth</label>
                    <select class="form-control" id="audio-bandwidth" v-model="audio.bandwidth" :disabled="skyway.mode.value == 'sfu'">
                      <option v-for="bandwidth in consts.audio.bandwidth" v-bind:value="bandwidth">{{ bandwidth.label }}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
      <div id="modal-speaker-volume" class="modal">
        <div class="modal-dialog modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Speaker Volume</h4>
            </div>
            <div class="modal-body">
              <div class="form-row">
                <div class="col">
                  <div class="form-group">
                    <select class="form-control" id="speaker-volume" v-model="speaker.volume">
                      <option v-for="volume in consts.speaker.volume" v-bind:value="volume.value">{{ volume.label }}</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <!-- <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button> -->
              <button type="button" class="btn btn-primary" data-dismiss="modal">OK</button>
            </div>
          </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
      </div><!-- /.modal -->
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="https://cdn.webrtc.ecl.ntt.com/skyway-latest.js"></script>

    <script src="./key.js"></script>
    <script src="./consts.js"></script>
    <script src="./main.js"></script>

    <script type="text/javascript">
      $(window).on('load resize', function(){
        $(".container").width(window.innerWidth);
        $(".container").height(window.innerHeight - $(".navbar").outerHeight());
        $(".text-container").width(0.25 * window.innerWidth);
        $(".text-container").height(window.innerHeight - $(".navbar").outerHeight());
        vm.update_video_layout()
      });
    </script>

  <script src="./pwa-loader.js"></script>

  </body>
</htm>
